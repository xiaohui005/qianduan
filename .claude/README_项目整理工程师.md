# 项目整理工程师系统

## 系统组成

### 1. Slash Command工作流
**文件**: `.claude/commands/organize-project.md`

完整的自动化工作流，包含5个阶段：
- 📋 项目整理
- 🧪 测试检查（调用test-engineer-cn）
- 🔍 代码质量检测
- 🔧 问题修复（调用前后端工程师）
- 📝 Git提交

**使用方法**:
```
/organize-project
```

### 2. Python辅助工具
**文件**: `project_organizer.py`

独立的Python脚本，用于快速检查项目规范：
- 文件大小检查（Python/JS ≤800行）
- 工具箱使用检查
- 代码重复检测
- 导入语句规范检查

**使用方法**:
```bash
python project_organizer.py
```

### 3. 使用文档
**文件**: `.claude/项目整理工程师使用说明.md`

详细的使用说明和工作流程文档。

## 快速开始

### 方式1：完整工作流（推荐）

在Claude Code中输入：
```
/organize-project
```

系统会自动执行完整流程并生成报告。

### 方式2：快速检查

运行Python脚本进行快速检查：
```bash
python project_organizer.py
```

会生成 `project_organization_report.json` 报告文件。

### 方式3：手动控制

直接向Claude Code描述需求：
```
请作为项目整理工程师，检查当前项目的代码规范，
重点检查文件大小和工具箱使用情况
```

## 工作流程图

```
┌─────────────────────────────────────────┐
│      项目整理工程师（主控）               │
└──────────────┬──────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│  阶段1: 项目整理                          │
│  - 检查文件大小                           │
│  - 检查工具箱使用                         │
│  - 检查代码重复                           │
│  - 生成整理报告                           │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│  阶段2: 测试检查                          │
│  调用 test-engineer-cn agent              │
│  - 功能测试                               │
│  - 边界条件测试                           │
│  - 异常处理测试                           │
└──────────────┬───────────────────────────┘
               │
               ▼
┌──────────────────────────────────────────┐
│  阶段3: 代码质量检测                      │
│  - 代码复杂度                             │
│  - 安全问题                               │
│  - 性能问题                               │
└──────────────┬───────────────────────────┘
               │
          ┌────┴────┐
          │ 有问题？ │
          └────┬────┘
               │
        Yes ───┼─── No
               │        │
               ▼        ▼
    ┌──────────────┐  ┌──────────────┐
    │ 阶段4: 修复  │  │ 阶段5: 提交  │
    │ 调用工程师   │  │ Git Commit   │
    │ - 前端修复   │  └──────────────┘
    │ - 后端修复   │
    │ - 重新测试   │
    └──────┬───────┘
           │
           └──→ 返回阶段2
```

## 检查标准

### 文件大小限制
- **Python文件**: 目标≤800行，最大≤1500行
- **JavaScript文件**: 目标≤800行，最大≤1500行
- **超标处理**: 建议拆分成独立模块

### 代码规范
- ✅ 使用 `backend.utils.get_db_cursor()` 管理数据库连接
- ✅ 使用 `backend.utils.wrap_in_range()` 处理号码循环
- ✅ 使用 `backend.utils.create_csv_response()` 导出CSV
- ❌ 不要直接使用 `get_connection()` 手动管理连接
- ❌ 不要重复定义工具箱已有的函数

### Git提交规范
- 使用中文提交信息
- 格式：`<type>: <描述>`
- type类型：feat, fix, refactor, docs, chore

## 输出示例

### Python脚本输出
```
============================================================
📋 项目整理报告
============================================================

⚠️  发现 2 个超大文件：
  🔴 backend/routes/analysis.py: 1969行 (限制800行)
  🔴 frontend/upload.js: 7744行 (限制800行)

⚠️  发现 3 处未使用工具箱的代码：
  🔴 backend/routes/collect.py:45
     应使用 backend.utils.get_db_cursor() 上下文管理器

✅ 导入语句规范

💡 发现 2 处可能的代码重复：
  ℹ️  函数 calculate_gap 在多个文件中定义，考虑提取到工具箱
     文件: backend/routes/analysis.py, backend/routes/recommend.py

============================================================
📊 共发现 5 个需要改进的地方
💡 建议：
   - 拆分超大文件，提高代码可维护性
   - 使用工具箱函数，避免代码重复
============================================================

📄 详细报告已保存到: project_organization_report.json
```

### Slash Command输出
```
📋 项目整理工程师工作报告

✅ 阶段1：项目整理 - 完成
   - 检查了 15 个Python文件
   - 发现 2 个文件超过800行需要拆分
   - 发现 3 处未使用工具箱函数的代码

🧪 阶段2：测试检查 - 进行中
   - 调用 test-engineer-cn agent...

... (完整流程)
```

## 注意事项

1. **首次使用**：
   - 确保已安装Python 3.7+
   - 确保项目结构符合CLAUDE.md规范

2. **执行环境**：
   - 在项目根目录执行
   - 确保有读取权限

3. **报告保存**：
   - JSON报告：`project_organization_report.json`
   - 可用于CI/CD集成

4. **问题修复**：
   - 建议先手动review问题
   - 再决定是否自动修复

## 扩展功能

### 集成到Git Hooks
可以将检查脚本添加到pre-commit hook：
```bash
# .git/hooks/pre-commit
#!/bin/bash
python project_organizer.py
if [ $? -ne 0 ]; then
    echo "代码规范检查未通过，请修复后再提交"
    exit 1
fi
```

### 定期检查
使用定时任务定期生成项目健康报告：
```bash
# 每周一早上9点检查
0 9 * * 1 cd /path/to/project && python project_organizer.py
```

## 相关文档

- 完整使用说明：`.claude/项目整理工程师使用说明.md`
- 项目规范：`CLAUDE.md`
- 工具箱文档：`backend/utils/README.md`

## 维护和更新

### 添加新的检查规则
编辑 `project_organizer.py`，在对应的检查方法中添加新规则。

### 修改工作流
编辑 `.claude/commands/organize-project.md`，调整工作流步骤。

### 反馈问题
如发现bug或有改进建议，请在项目中创建issue。

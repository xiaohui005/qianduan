# 推荐8码模块测试文档

## 测试环境

- **后端服务**：确保后端已启动（http://localhost:8000）
- **前端服务**：确保前端已启动（http://localhost:8080）
- **数据准备**：确保数据库中有开奖数据

## 功能测试清单

### 1. 模块加载测试

**测试步骤**：
1. 打开浏览器开发者工具（F12）
2. 打开前端页面（http://localhost:8080）
3. 查看控制台日志

**预期结果**：
- ✅ 控制台显示：`✅ 推荐8码模块已加载`
- ✅ 控制台显示：`✅ API 请求模块已加载`
- ✅ 无任何错误信息

---

### 2. 页面切换测试

**测试步骤**：
1. 点击左侧菜单"分析推荐"展开子菜单
2. 点击"推荐8码"按钮

**预期结果**：
- ✅ 页面标题显示"推荐8码"
- ✅ 右侧内容区显示推荐8码页面
- ✅ 控制台显示：`[页面管理] 检测到推荐8码页面`
- ✅ 控制台显示：`[页面管理] 调用 initRecommendModule()`
- ✅ 控制台显示：`初始化推荐8码模块...`

---

### 3. 自动加载测试

**测试步骤**：
1. 切换到"推荐8码"页面
2. 观察页面内容

**预期结果**：
- ✅ 显示"正在生成推荐..."加载状态
- ✅ 加载完成后显示推荐结果表格
- ✅ 显示"推荐基于期号"信息
- ✅ 显示7个位置的推荐号码
- ✅ 号码球有正确的颜色（红/蓝/绿）

---

### 4. 彩种切换测试

**测试步骤**：
1. 在推荐8码页面
2. 点击"香港"按钮
3. 观察页面变化

**预期结果**：
- ✅ "香港"按钮变为激活状态（active）
- ✅ "澳门"按钮取消激活状态
- ✅ 显示"正在生成推荐..."加载状态
- ✅ 加载完成后显示香港推荐结果
- ✅ 推荐基于的期号变为香港期号

**重复测试**：
1. 点击"澳门"按钮
2. 验证切换回澳门推荐

---

### 5. 无数据场景测试

**测试步骤**：
1. 清空数据库中的开奖数据（或使用测试彩种）
2. 切换到推荐8码页面

**预期结果**：
- ✅ 显示友好提示："暂无推荐结果，请先采集开奖数据"
- ✅ 无任何错误信息

---

### 6. 错误处理测试

**测试步骤**：
1. 停止后端服务
2. 刷新推荐8码页面

**预期结果**：
- ✅ 显示错误提示："推荐失败：..."
- ✅ 控制台输出详细错误信息
- ✅ 页面不崩溃，可以继续操作

---

### 7. 号码球样式测试

**测试步骤**：
1. 切换到推荐8码页面
2. 观察号码球的显示

**预期结果**：
- ✅ 红波号码显示红色背景
- ✅ 蓝波号码显示蓝色背景
- ✅ 绿波号码显示绿色背景
- ✅ 号码格式为两位数（01-49）
- ✅ 号码球有圆角边框
- ✅ 号码球有适当间距

---

### 8. 多次切换测试

**测试步骤**：
1. 快速多次点击"澳门"和"香港"按钮
2. 观察页面响应

**预期结果**：
- ✅ 页面正常响应，无卡顿
- ✅ 最终显示最后一次点击的彩种推荐
- ✅ 无重复请求或错误

---

### 9. 页面重新进入测试

**测试步骤**：
1. 从推荐8码页面切换到其他页面
2. 再次切换回推荐8码页面

**预期结果**：
- ✅ 模块重新初始化
- ✅ 自动加载推荐数据
- ✅ 按钮状态正确（默认显示澳门）

---

### 10. 性能测试

**测试步骤**：
1. 切换到推荐8码页面
2. 使用浏览器性能分析工具（Performance）记录加载过程

**预期结果**：
- ✅ 页面加载时间 < 1秒
- ✅ API 响应时间 < 500ms
- ✅ 渲染时间 < 100ms
- ✅ 无内存泄漏

---

## 集成测试

### 测试场景1：完整流程测试

1. 启动后端和前端服务
2. 采集澳门数据（期号以0或5结尾）
3. 切换到推荐8码页面
4. 验证推荐结果正确显示
5. 切换到香港
6. 验证香港推荐结果

### 测试场景2：数据更新测试

1. 查看当前推荐结果
2. 采集新的开奖数据（期号以0或5结尾）
3. 刷新推荐8码页面
4. 验证推荐结果已更新

---

## 常见问题

### Q1: 控制台显示"initRecommendModule 函数不存在"

**原因**：recommend.js 模块未正确加载

**解决方案**：
1. 检查 index.html 中是否引入了 recommend.js
2. 检查文件路径是否正确
3. 查看浏览器网络面板，确认文件加载成功

### Q2: 点击按钮后页面无反应

**原因**：事件监听器未正确绑定

**解决方案**：
1. 检查 DOM 元素是否存在（`.recommend-type-btn`）
2. 查看控制台是否有错误信息
3. 确认模块已正确初始化

### Q3: 号码球颜色不正确

**原因**：`getBallColorClass()` 函数未找到或CSS样式缺失

**解决方案**：
1. 确认 utils.js 已加载
2. 检查 CSS 文件中是否定义了 `.ball-red`, `.ball-blue`, `.ball-green`
3. 查看浏览器开发者工具的样式面板

### Q4: 切换彩种后显示旧数据

**原因**：状态未正确更新或缓存问题

**解决方案**：
1. 检查 `currentRecommendType` 变量是否正确更新
2. 清除浏览器缓存
3. 查看网络请求是否发送了正确的参数

---

## 测试报告模板

```
测试日期：____年____月____日
测试人员：________
测试环境：
  - 浏览器：________
  - 后端版本：________
  - 前端版本：________

测试结果：
  ✅ 通过：____ 项
  ❌ 失败：____ 项
  ⏭️ 跳过：____ 项

失败项详情：
  1.
  2.

建议：

```

---

## 自动化测试脚本（可选）

```javascript
// 在浏览器控制台运行的测试脚本

async function testRecommendModule() {
  console.log('开始测试推荐8码模块...');

  // 测试1: 模块是否加载
  if (typeof window.initRecommendModule !== 'function') {
    console.error('❌ 测试失败：模块未加载');
    return;
  }
  console.log('✅ 模块已加载');

  // 测试2: API 对象是否存在
  if (typeof window.API === 'undefined' || typeof window.API.generateRecommend !== 'function') {
    console.error('❌ 测试失败：API 对象不存在');
    return;
  }
  console.log('✅ API 对象存在');

  // 测试3: 调用推荐生成
  try {
    const data = await window.API.generateRecommend('am');
    if (data.recommend && data.recommend.length === 7) {
      console.log('✅ 推荐生成成功，包含7个位置');
      console.log('推荐基于期号：', data.used_period);
    } else {
      console.error('❌ 推荐数据格式不正确');
    }
  } catch (error) {
    console.error('❌ 推荐生成失败：', error);
  }

  console.log('测试完成');
}

// 运行测试
testRecommendModule();
```

---

## 测试数据准备

如果需要准备测试数据，可以使用以下SQL脚本：

```sql
-- 插入测试开奖数据（澳门）
INSERT INTO lottery_result (period, lottery_type, numbers, animals, open_time)
VALUES
  ('2025100', 'am', '01,12,23,34,45,06,17', '鼠,鼠,牛,虎,兔,龙,蛇', '2025-01-01 21:30:00'),
  ('2025105', 'am', '02,13,24,35,46,07,18', '鼠,牛,鼠,虎,兔,龙,蛇', '2025-01-02 21:30:00');

-- 插入测试开奖数据（香港）
INSERT INTO lottery_result (period, lottery_type, numbers, animals, open_time)
VALUES
  ('2025010', 'hk', '03,14,25,36,47,08,19', '牛,鼠,牛,虎,兔,龙,蛇', '2025-01-03 21:30:00'),
  ('2025015', 'hk', '04,15,26,37,48,09,20', '鼠,牛,鼠,虎,兔,龙,蛇', '2025-01-04 21:30:00');
```

---

## 回归测试清单

每次更新代码后，需要执行以下回归测试：

- [ ] 模块加载测试
- [ ] 页面切换测试
- [ ] 自动加载测试
- [ ] 彩种切换测试
- [ ] 号码球样式测试
- [ ] 错误处理测试
- [ ] 与其他模块的集成测试

---

## 相关文档

- [推荐8码模块源码](./recommend.js)
- [模块开发规范](./README.md)
- [API 文档](../api.js)

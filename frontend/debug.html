<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>è¯Šæ–­é¡µé¢ - å½©ç¥¨åˆ†æç³»ç»Ÿ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      background: white;
    }
    .success { border-left: 4px solid #4caf50; }
    .error { border-left: 4px solid #f44336; }
    .info { border-left: 4px solid #2196f3; }
    h1 { color: #333; }
    h2 { color: #666; margin-top: 30px; }
    pre { background: #f9f9f9; padding: 10px; border-radius: 3px; overflow-x: auto; }
    .loading { color: #ff9800; }
  </style>
</head>
<body>
  <h1>ğŸ” å½©ç¥¨åˆ†æç³»ç»Ÿè¯Šæ–­é¡µé¢</h1>

  <div id="status"></div>

  <h2>è¯Šæ–­æ­¥éª¤</h2>
  <div id="steps"></div>

  <script>
    const statusDiv = document.getElementById('status');
    const stepsDiv = document.getElementById('steps');
    let stepCount = 0;
    let errors = [];

    function addStep(message, type = 'info') {
      stepCount++;
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
      stepsDiv.innerHTML += `
        <div class="status ${className}">
          <strong>æ­¥éª¤${stepCount}:</strong> ${message}
        </div>
      `;
    }

    // æ­¥éª¤1: æµ‹è¯•åç«¯è¿æ¥
    addStep('æ­£åœ¨æµ‹è¯•åç«¯APIè¿æ¥...', 'loading');
    fetch('http://localhost:8000/')
      .then(res => res.json())
      .then(data => {
        addStep(`âœ“ åç«¯APIè¿æ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
        testJSFiles();
      })
      .catch(err => {
        addStep(`âœ— åç«¯APIè¿æ¥å¤±è´¥: ${err.message}`, 'error');
        errors.push('åç«¯APIæ— æ³•è®¿é—®');
        testJSFiles();
      });

    // æ­¥éª¤2: æµ‹è¯•JSæ–‡ä»¶åŠ è½½
    function testJSFiles() {
      addStep('æ­£åœ¨æµ‹è¯•å…³é”®JSæ–‡ä»¶åŠ è½½...', 'info');

      const coreFiles = [
        'js/config.js',
        'js/core/state.js',
        'js/core/common.js',
        'js/utils.js',
        'js/api.js',
        'js/pages.js'
      ];

      let loadedCount = 0;
      let failedCount = 0;

      coreFiles.forEach(file => {
        const script = document.createElement('script');
        script.src = file;

        script.onload = () => {
          loadedCount++;
          addStep(`âœ“ ${file} åŠ è½½æˆåŠŸ`, 'success');

          if (loadedCount + failedCount === coreFiles.length) {
            finishTest();
          }
        };

        script.onerror = () => {
          failedCount++;
          addStep(`âœ— ${file} åŠ è½½å¤±è´¥`, 'error');
          errors.push(`${file} æ— æ³•åŠ è½½`);

          if (loadedCount + failedCount === coreFiles.length) {
            finishTest();
          }
        };

        document.head.appendChild(script);
      });
    }

    // æ­¥éª¤3: å®Œæˆæµ‹è¯•
    function finishTest() {
      setTimeout(() => {
        addStep('è¯Šæ–­å®Œæˆ', 'info');

        if (errors.length === 0) {
          statusDiv.innerHTML = `
            <div class="status success">
              <h2>âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</h2>
              <p>ç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚å¦‚æœä¸»é¡µé¢ä»ç„¶æŠ¥é”™ï¼Œè¯·æŒ‰F12æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯ã€‚</p>
              <p><a href="index.html">ç‚¹å‡»è®¿é—®ä¸»é¡µé¢</a></p>
            </div>
          `;
        } else {
          statusDiv.innerHTML = `
            <div class="status error">
              <h2>âŒ å‘ç°é—®é¢˜</h2>
              <p>ä»¥ä¸‹é¡¹ç›®å­˜åœ¨é—®é¢˜ï¼š</p>
              <ul>
                ${errors.map(e => `<li>${e}</li>`).join('')}
              </ul>
            </div>
          `;
        }

        // æµ‹è¯•å…¨å±€å¯¹è±¡
        addStep('æ£€æŸ¥å…¨å±€å¯¹è±¡...', 'info');
        setTimeout(() => {
          const checks = [
            { name: 'window.BACKEND_URL', value: window.BACKEND_URL },
            { name: 'window.AppState', value: typeof window.AppState },
            { name: 'window.CommonUtils', value: typeof window.CommonUtils },
            { name: 'window.initPages', value: typeof window.initPages }
          ];

          checks.forEach(check => {
            if (check.value && check.value !== 'undefined') {
              addStep(`âœ“ ${check.name} = ${check.value}`, 'success');
            } else {
              addStep(`âœ— ${check.name} æœªå®šä¹‰`, 'error');
            }
          });
        }, 500);
      }, 1000);
    }
  </script>
</body>
</html>

# 遗漏监控配置功能使用说明

## 功能概述

遗漏监控配置功能允许您为每个监控点设置独立的触发条件，因为每个分析的规律不一样。

## 初始化步骤

### 1. 初始化数据库表

首次使用前需要初始化监控配置表：

```bash
cd backend
python init_monitor_config.py
```

执行成功后会看到：
- ✅ 监控配置表创建成功
- ✅ 默认配置数据已插入
- 📊 配置统计（澳门和香港各有多少配置）

### 2. 启动服务

```bash
# 启动后端
cd backend
python -m uvicorn main:app --host 0.0.0.0 --port 8000

# 启动前端（新终端）
cd frontend
python -m http.server 8080
```

### 3. 访问系统

打开浏览器访问：http://localhost:8080

## 使用方法

### 一、配置管理

1. 点击侧边栏的 **"⚙️ 遗漏监控配置"** 菜单
2. 选择彩种（澳门/香港）
3. 查看所有监控点的配置

#### 配置项说明

每个监控点有以下配置：

- **最小当前遗漏**：只有当前遗漏期数 ≥ 此值时才会触发预警
- **距离最大遗漏**：当前遗漏距离历史最大遗漏的差值 ≤ 此值时才会触发预警
- **启用/禁用**：开关按钮，控制该监控点是否生效

#### 操作方式

- **单个保存**：修改后点击该行的"保存"按钮
- **批量保存**：修改多个配置后，点击底部的"批量保存所有配置"
- **恢复默认**：点击"恢复默认值"将所有配置重置为默认值

### 二、查看监控预警

1. 点击侧边栏的 **"🔍 遗漏监控"** 菜单
2. 选择彩种（澳门/香港）
3. 点击 **"🔄 刷新监控"** 按钮

系统会：
- 自动读取数据库中的配置
- 扫描所有启用的监控点
- 显示符合条件的预警

#### 预警信息包括

- 分析类型和详情
- 期号
- 推荐号码
- 当前遗漏期数
- 历史最大遗漏
- 距离最大遗漏的差值
- 优先级（高/中/低）

## 配置建议

不同分析有不同的规律，建议根据历史数据调整参数：

### 短期规律（建议较小值）

- **去10最热20**：最小遗漏=6，距离最大=2
- **加减前6码**：最小遗漏=5，距离最大=2

### 中期规律（建议中等值）

- **+1~+20区间**：最小遗漏=8，距离最大=3
- **-1~-20区间**：最小遗漏=8，距离最大=3

### 长期规律（建议较大值）

- **前6码三中三**：最小遗漏=10，距离最大=2
- **5期3肖**：最小遗漏=10，距离最大=3

## 技术细节

### API端点

- `GET /api/monitor/configs` - 获取所有配置
- `POST /api/monitor/config` - 保存单个配置
- `POST /api/monitor/configs/batch` - 批量保存
- `GET /api/monitor/omission_alerts_v2` - 使用配置进行监控

### 数据库表结构

```sql
CREATE TABLE monitor_config (
    id INT AUTO_INCREMENT PRIMARY KEY,
    lottery_type VARCHAR(10) NOT NULL,  -- 彩种: am/hk
    analysis_type VARCHAR(50) NOT NULL, -- 分析类型
    detail VARCHAR(100),                -- 详情（如"第1组"）
    min_current_omission INT DEFAULT 8, -- 最小当前遗漏
    max_gap_from_max INT DEFAULT 3,     -- 距离最大遗漏
    enabled TINYINT(1) DEFAULT 1,       -- 是否启用
    ...
);
```

## 常见问题

### Q1: 没有看到预警怎么办？

可能原因：
1. 配置条件太严格，尝试降低最小遗漏或增加距离最大值
2. 监控点被禁用，检查配置管理中的开关
3. 当前确实没有符合条件的预警

### Q2: 如何恢复默认配置？

点击配置管理页面底部的"恢复默认值"按钮。

### Q3: 修改配置后需要重启服务吗？

不需要，配置保存后立即生效，刷新监控即可。

### Q4: 可以为澳门和香港设置不同的配置吗？

可以，每个彩种的配置是独立的。

## 更新日志

### v1.0 (2025-11-25)

- ✅ 创建监控配置数据库表
- ✅ 实现后端API（查询、保存、批量更新）
- ✅ 创建前端配置管理界面
- ✅ 集成到遗漏监控功能
- ✅ 移除手动配置表单，全部使用数据库配置
